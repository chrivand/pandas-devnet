# Hands-on excercise: detect above-average flows
In the last step, we will create a script that can detect above-average flows. 

## Objectives

After this step, you should be able to:
* Compare values and return a value based on this comparison. 

## Let's detect the outliers!

We may assume that we have two datasets: a dataset with the baseline and a dataset, where we should detect the outliers. 

1. We can utilize the function `average_bytes_per_flow_per_hostgroup(df)` that we created in the previous step. Using this function, we can establish the average flows for both the baseline dataset and the test dataset. 

    ```python
    baseline_dict = average_bytes_per_flow_per_hostgroup(df_baseline)
    test_dict = average_bytes_per_flow_per_hostgroup(df_test)
    ```
2. After having calculated the averages per flow per host group, we can compare the averages against the baseline. We do this by looping through the `test_dict` dictionary. Moreover, we also need to make sure that the flow in the test set already exists in the baseline. We store the results in a dictionary called the `results_dict`. The `results_dict` will have three options as values:
    * -1 indicates that the flow does not exist in the baseline dataset
    * 0 indicates that the flow does not exceed the baseline
    * 1 indicates that the flow exceeds the baseline

    ```python
    results_dict = {}
    for subject_peer_pair in test_dict:
      # subject peer pair does not exist
      if not subject_peer_pair in baseline_dict:
          results_dict[subject_peer_pair] = -1
      # flow is less than or equal to baseline
      if scan_dict[subject_peer_pair] <= baseline_dict[subject_peer_pair]:
          results_dict[subject_peer_pair] = 0 
      # flow is more than the baseline
      else:
          results_dict[subject_peer_pair] = 1
      ```

3. We can put all of these components together in a function that takes both datasets as a DataFrame and that returns the `results_dict`: 

    ```python
    def detect_above_average_flows(df_baseline, df_test):
      baseline_dict = average_bytes_per_flow_per_hostgroup(df_baseline)
      test_dict = average_bytes_per_flow_per_hostgroup(df_test)

      results_dict = {}

      for subject_peer_pair in test_dict:
          # subject peer pair does not exist
          if not subject_peer_pair in baseline_dict:
              results_dict[subject_peer_pair] = -1
          # flow is less than or equal to baseline
          if scan_dict[subject_peer_pair] <= baseline_dict[subject_peer_pair]:
              results_dict[subject_peer_pair] = 0 
          # flow is more than the baseline
          else:
              results_dict[subject_peer_pair] = 1

    return results_dict
    ```

    

**Next Step: Wrap-Up**